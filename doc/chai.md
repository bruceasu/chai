# 基础

## 画布

**定义**（画布）在二维空间中，我们建立一个平面直角坐标系，使得 $x$ 轴正方向向右、$y$ 轴正方向向下；取其中 $[0, 1]\times [0, 1]$ 的子集称为一个画布。

## 曲线

**定义**（曲线）设参数 $t$ 的取值范围是 $[0, 1]$，在该范围内存在两个函数关系 $x(t)$ 和 $y(t)$，它们的值域也包含于 $[0, 1]$。我们记二维向量函数 $\boldsymbol r(t)=(x(t),y(t))$，则当 $t$ 从 $0$ 变化到 $1$ 时，向量函数所代表的平面上的点将绘制出画布上的一条参数曲线，简称为曲线。

出于计算机绘图的便利性，我们采用的一类具体的曲线是 Bezier 曲线，特别地有一次 Bezier 曲线和三次 Bezier 曲线。

记 $\boldsymbol P_i$ 是点，则一次 Bezier 曲线的形式为：

$$
\boldsymbol r_1(t)=(1-t)\boldsymbol P_1+t\boldsymbol P_2
$$

它的几何直观是：$t=0$ 时，函数位于 $\boldsymbol P_1$ 处，而 $t=1$ 时，函数位于 $\boldsymbol P_2$ 处，且它是连接 $\boldsymbol P_1,\boldsymbol P_2$ 的一条直线。

三次 Bezier 曲线的形式为：

$$
\boldsymbol r_3(t) = (1-t)^3\boldsymbol P_1 + 3(1-t)^2t\boldsymbol P_2 + 3(1-t)t^2\boldsymbol P_3 + t^3\boldsymbol P_4
$$

## 笔画

**定义**（笔画）笔画是由一段或多段曲线首尾相接组成的几何图形，通常记作 $s$。

这里，「首尾相接」的含义是：上一段曲线参数值取 1 的点恰等于下一段曲线参数值取 0 的点。

根据国标规范，共有 31 种基本笔画，它们用曲线表示的具体方法参见[数据库文档](hanzi-chai.github.io/data/)。

# 汉字的嵌套表示

## 部件

**定义**（部件）由一个或多个笔画在平面上按一定顺序在给定位置上排布组成的几何图形，通常记作 $c$。

**定义**（运算符）用于表示部件之间二元关系的记号。

本项目共采用 12 个运算符，具体参见[数据库文档](hanzi-chai.github.io/data/)。两个部件经过运算符的运算，就得到了一个**表达式**；表达式可以继续参与运算符的运算，形成。

## 汉字

在一个给定字集内（下面我们都用 GB2312-80 规范所规定的 6763 个汉字作为字集），根据字形、字源等因素，我们可以递降地总结出一个部件集 $C$，将每个汉字

- 要么与部件集中的一个部件对应；
- 要么与「部件集中的部件和指定的 12 个运算符经过有限次运算形成的表达式」相对应。

# 部件的拆分

**定义**（笔画列表）部件 $c$ 所包含的笔画形成的序列 $\operatorname{str}c=(s_1,s_2,\cdots,s_n)$。

**定义**（切片）设部件 $c$ 的笔画列表的长度为 $n$，我们指定一组指标 $i_1,\cdots,i_n$ 使得
$$
1\le i_1\le\cdots\le i_n\le n
$$
那么由第 $i_1,\cdots,i_n$ 个笔画在平面上按此顺序在原有位置上排布组成的几何图形称为一个切片。

我们将切片记为 $p_i=c[i_1,\cdots,i_n]$。显然，它的笔画序列为
$$
\operatorname{str}(c[i_1,\cdots,i_n])=(s_{i_1},\cdots,s_{i_n})
$$
**定义**（部件的拆分）给定部件 $c$，我们称由 $k$ 个 $c$ 的切片构成的 $k$ 元组 $d=(p_1,\cdots,p_k)$ 是一个拆分，当且仅当任两个切片无共同笔画，且所有切片所含的笔画的并集等于汉字 $c$ 的所有笔画。

**定义**（部件的拆分集）给定汉字 $c$，由所有可能拆分 $d$ 构成的集合 $D$。

### 拆分第一要素：字根集

**定义**（字根）字根同样是由若干笔画在平面上按一定顺序在给定位置上排布组成的几何图形，但这些图形是特别指定的。字根通常记作 $r$。

**定义**（字根集）所有我们指定的字根构成一个集合 $R$。

### 拆分第二要素：退化映射

**定义**（退化映射）$\mathcal O$ 将一个切片或一个字根映射为含有较少信息的对象，且满足：
$$
\forall r_1,r_2\in R,r_1\ne r_2\Rightarrow \mathcal O(r_1)\ne \mathcal O(r_2)
$$
即 $\mathcal O$ 在字根集 $R$ 上是单射。

**定义**（部件的可行拆分集）给定汉字 $c$，它的拆分集是 $D$，则它的可行拆分集 $W$ 定义为：
$$
W=\{d|d\in D;\forall p\in d, \exists r\in R\text{ s.t. }\mathcal O(r)=\mathcal O(p)\}
$$

即：对于该拆分中的每一个切片，都存在一个字根使得该字根退化后得到的对象与该切片退化后得到的对象一致。

### 拆分第三要素：择优函数

**定义**（择优函数）给定部件 $c$ 和它的可行拆分集 $W$，我们可以给 $W$ 中的每一个拆分指定一个实数，由此确定的映射为 $\mathcal H$。我们进一步要求这个映射是单射。
$$
\mathcal H:W\to\mathbb R
$$

### 拆分三要素完全决定了一个部件的拆分结果

给定一个部件 $c$，我们首先获得它的拆分集 $D$，再根据字根集 $R$ 和退化映射 $\mathcal O$ 确定可行拆分集 $W$。注意：可行拆分集中，每一个拆分中的每一个切片都与恰好一个字根关于退化映射有相同的像，因此每一个拆分都对应着一个「多个字根构成的序列」。

又因为每一个拆分都被指定了一个不同的实数，我们总能找到数最小的一个拆分。这个拆分所对应的字根的序列就是我们的拆分结果。

# 汉字的拆分

## 选根函数

**定义**（选根函数）选根函数 $\mathcal Y$ 具有以下功能：

- 如果汉字能够对应到一个部件，则选根函数作用于该部件的最优拆分，按一定顺序选出若干个字根；
- 如果汉字

# 退化映射初探

退化映射是一种非常重要的看法，它能够将每一个具体的字中的切片转化为抽象的切片，也即在不同字中有微小形变的切片 $p,p', p''\cdots$ 在输入方案的角度来看可以看作是一个字根 $r$。

## 笔画归类与排序

在 31 种笔画中，有一些笔画从字源上讲是同源的，出于不违反人们的文字习惯考虑，我们可能会将几种不同的笔画归为一个**笔画类**，例如竖钩和竖可能归为一类。给定一种分类方法，对于笔画 $b$ 来说，我们记它所属的类为 $\operatorname{cat}(b)$。所有笔画类构成一个集合 $X$。

我们现在可以定义一种最简单的退化映射。记切片或字根 $p$ 的笔画序列为 $\operatorname{str}(p)=(b_1,\cdots,b_n)$，则这个映射可以表示为
$$
\mathcal O:p\to X^n
$$

$$
\mathcal O(p)=(\operatorname{cat}(b_1),\cdots,\operatorname{cat}(b_n))
$$

**实例** 假设我们只分横竖撇点折五类，$X=\{1,2,3,4,5\}$，设 $p_1$ 是由「土」的全部笔画构成的切片，$p_2$ 是由「工」的全部笔画构成的切片，则
$$
\mathcal O(p_1)=\mathcal O(p_2)=(1,2,1)
$$

## 笔画关系

显然，这种分类是非常粗糙的，我们还需要加入更多信息。我们可以定义一个**关系映射**，将两个笔画映射到它们之间的关系：
$$
\mathcal R:B^2\to R
$$
这样我们就可以定义更好一点的退化映射：
$$
\mathcal O:P\to X^{n}\times R^{n^2}
$$

$$
\mathcal O(p)=\left[(\operatorname{cat}(b_1),\cdots,\operatorname{cat}(b_n)),(\mathcal R(b_1,b_1),\cdots,\mathcal R(b_n,b_n))\right]
$$

**实例** 我们记「散（$\odot$）、连（$\oplus$）、交（$\otimes$）」是三种关系，并且笔画和自己没有关系、两个笔画的关系是相互的。则上述的 $p_1,p_2$ 会变为
$$
\mathcal O(p_1)=[(1,2,1),(1\otimes2,1\odot3,2\oplus3)]
$$

$$
\mathcal O(p_2)=[(1,2,1),(1\oplus2,1\odot3,2\oplus3)]
$$

可见我们实现了区分。

### 从代数表示中获取笔画拓扑信息

先考虑较简单的情况，两个由一条 Bezier 曲线构成的笔画之间的关系。此时我们首先解方程：
$$
\boldsymbol b_i(t_i)=\boldsymbol b_j(t_j)
$$
若求得这样的解，检验是否有 $0\le t_i,t_j\le 1$。

- 若无解，两笔画相离；
- 若有解，且 $t_i,t_j$ 中的一个约等于 0 或 1，那么两笔画相接，一笔画的端位接到另一笔画的中间；
- 若有解，且 $t_i,t_j$ 都约等于 0 或 1，那么两笔画相接，一笔画的端位接到另一笔画的端位；
- 若有解，且上述条件不满足，则两笔画相交。

## 笔画长度

不过，我们还是区分不开「土」和「士」。为此我们可以给所有同类笔画定义笔画长度序，用 ABCD 标记。然后记「士」为 $p_3$，则我们大致可以写成
$$
\mathcal O(p_1)=\rm[(1B,2A,1A),(1\otimes2,1\odot3,2\oplus3)]
$$

$$
\mathcal O(p_3)=\rm[(1A,2A,1B),(1\otimes2,1\odot3,2\oplus3)]
$$

# 择优函数初探

## 笔画数量和顺序择优

回顾一下择优函数的定义：将可行拆分集 $W$ 单射到实数集 $\mathbb R$。我们首先将一个字的笔画数计为 $L$，则任何一个字根不可能有 $L+1$ 个笔画。那么我们定义
$$
\mathcal H(d)=\sum_{i=1}^k\operatorname{len}(p_i)(L+1)^{-i}
$$
就实现了「取大优先」。

## 字根关系择优

我们可以基于笔画关系定义字根关系。如果两个字根间有笔画相交，则为交；不交但有笔画为连，则为连；其余为散。这样定义出来的映射记为 $\tilde{\mathcal R}(r_1,r_2)$，然后定义发生交、连、散的次数分别为 $u_1,u_2,u_3$。字根数量不可能超过 $L$，所以我们定义
$$
\mathcal H(d)=u_1(L+1)^2+u_2(L+1)+u_3+\sum_{i=1}^k\operatorname{len}(p_i)(L+1)^{-i}
$$
这样，我们就能把「天」拆成「一大」，把「夫」拆成「二人」。

## 字根数量择优

例如在有笔顺限制的情况下把「区」拆成「匚乂」，如果我们定义 $\operatorname{len}(d)$ 为其中含字根的个数，那么我们设法把 $\operatorname{len}(d)$ 加入 $\mathcal H$ 中即可。

# 开发计划

## 汉字自动拆分系统 I 期工程

### 目标

- 根据嵌套拆分方法，将 GB 2312 标准中的 6763 字递归表示为 600 基本部件
- 针对 600 基本部件，参考文泉驿数据库编写它们的代数表示
- 建立几套可选的退化映射
- 建立几套可选的择优函数
- 用自动拆分系统重建几个常见输入方案（至少含五笔、二笔），方便用户基于它们修改
- 发布为 Python 的第三方库

### 时限

预计可在 2019 年 12 月 31 日之前做完。

## 汉字自动拆分系统 II 期工程

（待续）

## 汉字自动拆分系统 III 期工程

（待续）